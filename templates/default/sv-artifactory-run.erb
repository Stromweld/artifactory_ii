#! /bin/sh
exec 2>&1

export JAVA_HOME=<%= node['java']['home'] %>

export TOMCAT_HOME=/usr/local/artifactory/tomcat
export ARTIFACTORY_HOME=<%= node['artifactory_ii']['home'] %>
export ARTIFACTORY_PID=$ARTIFACTORY_HOME/run/artifactory.pid
export CATALINA_BASE=<%= node['artifactory_ii']['catalina_base'] %>

export JAVA_OPTIONS='-server -Xmx<%= node['artifactory_ii']['java']['xmx'] %> -Xms<%= node['artifactory_ii']['java']['xms'] %> -Xss256k -XX:PermSize=128m -XX:MaxPermSize=128m <%= node['artifactory_ii']['java']['extra_opts'] %>"

export CATALINA_OPTS="$JAVA_OPTIONS -Dartifactory.home=$ARTIFACTORY_HOME -Dfile.encoding=UTF8"


[ -x $TOMCAT_HOME/bin/catalina.sh ] || chmod +x $TOMCAT_HOME/bin/*.sh

cd "$ARTIFACTORY_HOME"
exec chpst -u <%= node['artifactory_ii']['user'] %> $TOMCAT_HOME/bin/catalina.sh run
